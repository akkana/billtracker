# Notes on Flask

(helpful when adding new functionality)

# Templates

Any variables that you want a template to be able to access with {{ var }}
should be passed as render_template(..., var=value) otherwise the template
won't see them (except certain global variables, maybe).

# Form submission:

To add a new form, reate a URL in routes.py, a class in forms.py,
and a template in templates/.

Validation happens in forms.py.
Any code that does something useful with the submitted data needs
to go in routes.py.
routes.py is also the place to clear the form field if you go back to
the same form after submitting.

# Database Upgrade and Downgrade Workflow

- Update models.db
- flask db migrate
- review the migration file to make sure it looks right
- flask db upgrade

## Migrations: adding/dropping tables in sqlite3

sqlite3 doesn't have any support for dropping tables.
Alembic has a way to do that with batch operations but it doesn't
do it by default. So if your migration has a line like:
    op.drop_column('user', 'bills_seen')
you need to edit it to use batch operations instead:
    with op.batch_alter_table('user') as batch_op:
        batch_op.drop_column('bills_seen')
None of the flask db tutorials I've seen mentioned this
even though most of them use sqlite.

## Fixing a migration problem

I made a migration, did flask db migrate but not flask db upgrade,
then decided I didn't want that migration after all and removed the
file. This makes alembic unhappy. But you can set the current version:
flask db stamp head

# Restart apache:

apachectl -k graceful
